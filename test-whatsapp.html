<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            margin: 40px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 3px;
            font-family: monospace;
            direction: ltr;
            text-align: left;
        }
        button {
            background: #25d366;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1ea952;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ - ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h1>
        
        <div class="test-case">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± 1: Ø±Ù‚Ù… ÙƒÙˆÙŠØªÙŠ Ù…Ø¹ 965+ (ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨)</h3>
            <p>Ø§Ù„Ø±Ù‚Ù…: +96512345678</p>
            <button onclick="testWhatsApp('+96512345678', 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', true)">Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨</button>
            <button onclick="testWhatsApp('+96512345678', 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', false)">Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù…ÙˆØ¨Ø§ÙŠÙ„</button>
            <div class="result" id="result1"></div>
        </div>

        <div class="test-case">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± 2: Ø±Ù‚Ù… ÙƒÙˆÙŠØªÙŠ Ø¨Ø¯ÙˆÙ† Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø© (ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨)</h3>
            <p>Ø§Ù„Ø±Ù‚Ù…: 12345678</p>
            <button onclick="testWhatsApp('12345678', 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', true)">Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨</button>
            <div class="result" id="result2"></div>
        </div>

        <div class="test-case">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± 3: Ø±Ù‚Ù… ÙƒÙˆÙŠØªÙŠ Ù…Ø¹ ØµÙØ± Ø¨Ø¯Ø§ÙŠØ© (ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨)</h3>
            <p>Ø§Ù„Ø±Ù‚Ù…: 012345678</p>
            <button onclick="testWhatsApp('012345678', 'Ù…Ø­Ù…Ø¯ Ø³Ø§Ù„Ù…', true)">Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨</button>
            <div class="result" id="result3"></div>
        </div>

        <div class="test-case">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± 4: Ù…Ù‚Ø§Ø±Ù†Ø© ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</h3>
            <p>Ø§Ù„Ø±Ù‚Ù…: (+965) 1234-5678</p>
            <button onclick="testWhatsApp('(+965) 1234-5678', 'Ø³Ø§Ø±Ø© Ø®Ø§Ù„Ø¯', true)">ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨</button>
            <button onclick="testWhatsApp('(+965) 1234-5678', 'Ø³Ø§Ø±Ø© Ø®Ø§Ù„Ø¯', false)">ÙˆØ§ØªØ³Ø§Ø¨ Ù…ÙˆØ¨Ø§ÙŠÙ„</button>
            <div class="result" id="result4"></div>
        </div>

        <div class="test-case">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± 5: Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­</h3>
            <p>Ø§Ù„Ø±Ù‚Ù…: ÙØ§Ø±Øº Ø£Ùˆ null</p>
            <button onclick="testWhatsApp('', 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„', true)">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            <div class="result" id="result5"></div>
        </div>

        <div class="test-case">
            <h3>Ø§Ø®ØªØ¨Ø§Ø± 6: Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h3>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</p>
            <button onclick="testNotification('joiningFeeApproved', 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯')">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</button>
            <button onclick="testNotification('loanApproved', 'ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ', '2000.000', '150.000', '14')">Ø§Ø¹ØªÙ…Ø§Ø¯ Ù‚Ø±Ø¶</button>
            <button onclick="testNotification('transactionApproved', 'Ù…Ø­Ù…Ø¯ Ø³Ø§Ù„Ù…', '50.000', 'subscription', '180.000')">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ø´ØªØ±Ø§Ùƒ</button>
            <div class="result" id="result6"></div>
        </div>
    </div>

    <script>
        // Copy the Utils WhatsApp functions for testing
        const Utils = {
            formatWhatsAppNumber: (phoneNumber, countryCode = '965') => {
                if (!phoneNumber) return null;
                
                // Clean the phone number - remove all non-digits
                let cleanNumber = phoneNumber.toString().replace(/\D/g, '');
                
                // Remove leading zeros
                cleanNumber = cleanNumber.replace(/^0+/, '');
                
                // If number already starts with country code, use as is
                if (cleanNumber.startsWith(countryCode)) {
                    return cleanNumber;
                }
                
                // Add country code for Kuwait (965) by default
                return countryCode + cleanNumber;
            },

            getWhatsAppChatUrl: (phoneNumber, message = '', useWeb = true) => {
                const formattedNumber = Utils.formatWhatsAppNumber(phoneNumber);
                if (!formattedNumber) return null;
                
                const encodedMessage = encodeURIComponent(message);
                const baseUrl = useWeb ? 'https://web.whatsapp.com/send' : 'https://wa.me';
                
                if (useWeb) {
                    return `${baseUrl}?phone=${formattedNumber}${message ? `&text=${encodedMessage}` : ''}`;
                } else {
                    return `${baseUrl}/${formattedNumber}${message ? `?text=${encodedMessage}` : ''}`;
                }
            },

            openWhatsAppChat: (phoneNumber, message = '', useWeb = true) => {
                const url = Utils.getWhatsAppChatUrl(phoneNumber, message, useWeb);
                if (url) {
                    if (useWeb) {
                        window.open(url, '_blank', 'width=1200,height=700,scrollbars=yes,resizable=yes');
                    } else {
                        window.open(url, '_blank', 'noopener,noreferrer');
                    }
                    return true;
                }
                return false;
            }
        };

        let testCounter = 1;

        function testWhatsApp(phoneNumber, userName, useWeb = true) {
            const message = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userName}ØŒ Ø£ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù…Ù† Ø¥Ø¯Ø§Ø±Ø© ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ`;
            
            // Test the formatting
            const formattedNumber = Utils.formatWhatsAppNumber(phoneNumber);
            const fullUrl = Utils.getWhatsAppChatUrl(phoneNumber, message, useWeb);
            
            const resultElement = document.getElementById(`result${testCounter}`);
            const platform = useWeb ? 'ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨' : 'ÙˆØ§ØªØ³Ø§Ø¨ Ù…ÙˆØ¨Ø§ÙŠÙ„';
            const platformIcon = useWeb ? 'ğŸŒ' : 'ğŸ“±';
            
            if (formattedNumber && fullUrl) {
                resultElement.innerHTML = `
                    <strong>âœ… Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (${platform}):</strong><br>
                    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø³Ù‚: ${formattedNumber}<br>
                    Ø§Ù„Ù…Ù†ØµØ©: ${platformIcon} ${platform}<br>
                    <br>
                    <strong>Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ„Ø¯:</strong><br>
                    <a href="${fullUrl}" target="_blank" style="color: #25d366; word-break: break-all;">${fullUrl}</a>
                    <br><br>
                    <button onclick="window.open('${fullUrl}', '_blank', '${useWeb ? 'width=1200,height=700,scrollbars=yes,resizable=yes' : 'noopener,noreferrer'}')" style="background: #25d366;">
                        ${platformIcon} ÙØªØ­ ÙÙŠ ${platform}
                    </button>
                `;
                resultElement.style.background = '#e8f5e8';
            } else {
                resultElement.innerHTML = `
                    <strong>âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (${platform}):</strong><br>
                    Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ ÙØ§Ø±Øº<br>
                    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ØµÙ„ÙŠ: "${phoneNumber}"<br>
                    Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø³Ù‚: ${formattedNumber || 'null'}
                `;
                resultElement.style.background = '#fde8e8';
            }
            
            testCounter++;
            if (testCounter > 6) testCounter = 1;
        }

        // Test notification messages
        function testNotification(templateType, userName, ...args) {
            const phoneNumber = '96512345678'; // Test number
            
            // Copy notification templates for testing
            const templates = {
                joiningFeeApproved: (userName) => `ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©

Ù…Ø¨Ø±ÙˆÙƒ ${userName}! ğŸ‰

ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… ÙˆØ£ØµØ¨Ø­Øª Ø¹Ø¶ÙˆØ§Ù‹ ÙØ¹Ø§Ù„Ø§Ù‹ ÙÙŠ ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©.

âœ… Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:
â€¢ Ø§Ø¨Ø¯Ø£ Ø¨Ø¯ÙØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
â€¢ Ø§Ù„Ù‡Ø¯Ù: 240 Ø¯.Ùƒ Ø®Ù„Ø§Ù„ 24 Ø´Ù‡Ø± Ù„Ù„ØªØ£Ù‡Ù„ Ù„Ù„Ù‚Ø±ÙˆØ¶
â€¢ Ø¨Ø¹Ø¯ Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø© Ø³ØªØµØ¨Ø­ Ù…Ø¤Ù‡Ù„Ø§Ù‹ Ù„Ø·Ù„Ø¨ Ø§Ù„Ù‚Ø±ÙˆØ¶
â€¢ Ø§Ø­ØªÙØ¸ Ø¨Ø±ØµÙŠØ¯ 500 Ø¯.Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„

Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ø¦Ù„Ø© Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©
Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚`,

                loanApproved: (userName, loanAmount, installmentAmount, numberOfInstallments) => `ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø¶

Ù…Ø¨Ø±ÙˆÙƒ ${userName}! ğŸ’°

ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ø·Ù„Ø¨ Ø§Ù„Ù‚Ø±Ø¶ Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ©:

ğŸ’° Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø±Ø¶: ${loanAmount} Ø¯.Ùƒ
ğŸ“… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ: ${installmentAmount} Ø¯.Ùƒ
ğŸ”¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·: ${numberOfInstallments} Ù‚Ø³Ø·

âœ… ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù†:
â€¢ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¯ÙØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
â€¢ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø±Ø¶ Ù…Ù† Ø­Ø³Ø§Ø¨Ùƒ
â€¢ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©

ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ ÙˆØ¨Ø§Ù„ØªÙˆÙÙŠÙ‚!
Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©`,

                transactionApproved: (userName, amount, transactionType, totalSubscriptions = null) => {
                    const typeText = {
                        'deposit': 'Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹',
                        'withdrawal': 'Ø§Ù„Ø³Ø­Ø¨', 
                        'subscription': 'Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ',
                        'joining_fee': 'Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…'
                    }[transactionType] || 'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©';

                    let message = `ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© - Ù‚Ø¨ÙˆÙ„ ${typeText}

Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userName} âœ…

ØªÙ… Ù‚Ø¨ÙˆÙ„ ${typeText} Ø¨Ù…Ø¨Ù„Øº ${amount} Ø¯.Ùƒ Ø¨Ù†Ø¬Ø§Ø­.`;

                    if (transactionType === 'subscription' && totalSubscriptions) {
                        message += `\n\nğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙƒ: ${totalSubscriptions} Ø¯.Ùƒ`;
                        
                        const remaining = Math.max(0, 240 - parseFloat(totalSubscriptions));
                        if (remaining > 0) {
                            message += `\nğŸ’¡ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù€240 Ø¯.Ùƒ: ${remaining.toFixed(3)} Ø¯.Ùƒ`;
                        } else {
                            message += `\nğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ£Ù‡Ù„ Ù„Ù„Ù‚Ø±ÙˆØ¶`;
                        }
                    }

                    message += `\n\nØ´ÙƒØ±Ø§Ù‹ Ù„Ùƒ
Ø¥Ø¯Ø§Ø±Ø© Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©`;
                    return message;
                }
            };

            let message = '';
            try {
                switch (templateType) {
                    case 'joiningFeeApproved':
                        message = templates.joiningFeeApproved(userName);
                        break;
                    case 'loanApproved':
                        message = templates.loanApproved(userName, ...args);
                        break;
                    case 'transactionApproved':
                        message = templates.transactionApproved(userName, ...args);
                        break;
                    default:
                        message = `Ø§Ø®ØªØ¨Ø§Ø± ${templateType} Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userName}`;
                }

                const url = Utils.getWhatsAppChatUrl(phoneNumber, message, true);
                const resultElement = document.getElementById('result6');
                
                resultElement.innerHTML = `
                    <strong>âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:</strong><br>
                    <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${templateType}<br>
                    <strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${userName}<br>
                    <br>
                    <strong>Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</strong><br>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; white-space: pre-line; font-family: 'Courier New', monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                        ${message}
                    </div>
                    <br>
                    <button onclick="window.open('${url}', '_blank', 'width=1200,height=700,scrollbars=yes,resizable=yes')" style="background: #25d366;">
                        ğŸŒ ÙØªØ­ ÙÙŠ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨
                    </button>
                `;
                resultElement.style.background = '#e8f5e8';
            } catch (error) {
                document.getElementById('result6').innerHTML = `
                    <strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±:</strong><br>
                    ${error.message}
                `;
                document.getElementById('result6').style.background = '#fde8e8';
            }
        }
    </script>
</body>
</html>