<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุฑูุงุจุท ุงููุงุชุณุงุจ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            margin: 40px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 3px;
            font-family: monospace;
            direction: ltr;
            text-align: left;
        }
        button {
            background: #25d366;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1ea952;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>๐งช ุงุฎุชุจุงุฑ ุฑูุงุจุท ุงููุงุชุณุงุจ - ุตูุฏูู ุฏุฑุน ุงูุนุงุฆูุฉ</h1>
        
        <div class="test-case">
            <h3>ุงุฎุชุจุงุฑ 1: ุฑูู ูููุชู ูุน 965+ (ูุงุชุณุงุจ ููุจ)</h3>
            <p>ุงูุฑูู: +96512345678</p>
            <button onclick="testWhatsApp('+96512345678', 'ุฃุญูุฏ ูุญูุฏ', true)">ุงุฎุชุจุงุฑ ูุงุชุณุงุจ ููุจ</button>
            <button onclick="testWhatsApp('+96512345678', 'ุฃุญูุฏ ูุญูุฏ', false)">ุงุฎุชุจุงุฑ ูุงุชุณุงุจ ููุจุงูู</button>
            <div class="result" id="result1"></div>
        </div>

        <div class="test-case">
            <h3>ุงุฎุชุจุงุฑ 2: ุฑูู ูููุชู ุจุฏูู ุฑูุฒ ุงูุฏููุฉ (ูุงุชุณุงุจ ููุจ)</h3>
            <p>ุงูุฑูู: 12345678</p>
            <button onclick="testWhatsApp('12345678', 'ูุงุทูุฉ ุนูู', true)">ุงุฎุชุจุงุฑ ูุงุชุณุงุจ ููุจ</button>
            <div class="result" id="result2"></div>
        </div>

        <div class="test-case">
            <h3>ุงุฎุชุจุงุฑ 3: ุฑูู ูููุชู ูุน ุตูุฑ ุจุฏุงูุฉ (ูุงุชุณุงุจ ููุจ)</h3>
            <p>ุงูุฑูู: 012345678</p>
            <button onclick="testWhatsApp('012345678', 'ูุญูุฏ ุณุงูู', true)">ุงุฎุชุจุงุฑ ูุงุชุณุงุจ ููุจ</button>
            <div class="result" id="result3"></div>
        </div>

        <div class="test-case">
            <h3>ุงุฎุชุจุงุฑ 4: ููุงุฑูุฉ ูุงุชุณุงุจ ููุจ ููุงุจู ุงูููุจุงูู</h3>
            <p>ุงูุฑูู: (+965) 1234-5678</p>
            <button onclick="testWhatsApp('(+965) 1234-5678', 'ุณุงุฑุฉ ุฎุงูุฏ', true)">ูุงุชุณุงุจ ููุจ</button>
            <button onclick="testWhatsApp('(+965) 1234-5678', 'ุณุงุฑุฉ ุฎุงูุฏ', false)">ูุงุชุณุงุจ ููุจุงูู</button>
            <div class="result" id="result4"></div>
        </div>

        <div class="test-case">
            <h3>ุงุฎุชุจุงุฑ 5: ุฑูู ุบูุฑ ุตุญูุญ</h3>
            <p>ุงูุฑูู: ูุงุฑุบ ุฃู null</p>
            <button onclick="testWhatsApp('', 'ูุณุชุฎุฏู ูุฌููู', true)">ุงุฎุชุจุงุฑ ุงูุฑุงุจุท</button>
            <div class="result" id="result5"></div>
        </div>

        <div class="test-case">
            <h3>ุงุฎุชุจุงุฑ 6: ุฅุดุนุงุฑุงุช ุฏุฑุน ุงูุนุงุฆูุฉ</h3>
            <p>ุงุฎุชุจุงุฑ ุฑุณุงุฆู ุงูุฅุดุนุงุฑุงุช ุงููุฎุชููุฉ</p>
            <button onclick="testNotification('joiningFeeApproved', 'ุฃุญูุฏ ูุญูุฏ')">ุงุนุชูุงุฏ ุงูุนุถููุฉ</button>
            <button onclick="testNotification('loanApproved', 'ูุงุทูุฉ ุนูู', '2000.000', '150.000', '14')">ุงุนุชูุงุฏ ูุฑุถ</button>
            <button onclick="testNotification('transactionApproved', 'ูุญูุฏ ุณุงูู', '50.000', 'subscription', '180.000')">ุงุนุชูุงุฏ ุงุดุชุฑุงู</button>
            <div class="result" id="result6"></div>
        </div>
    </div>

    <script>
        // Copy the Utils WhatsApp functions for testing
        const Utils = {
            formatWhatsAppNumber: (phoneNumber, countryCode = '965') => {
                if (!phoneNumber) return null;
                
                // Clean the phone number - remove all non-digits
                let cleanNumber = phoneNumber.toString().replace(/\D/g, '');
                
                // Remove leading zeros
                cleanNumber = cleanNumber.replace(/^0+/, '');
                
                // If number already starts with country code, use as is
                if (cleanNumber.startsWith(countryCode)) {
                    return cleanNumber;
                }
                
                // Add country code for Kuwait (965) by default
                return countryCode + cleanNumber;
            },

            getWhatsAppChatUrl: (phoneNumber, message = '', useWeb = true) => {
                const formattedNumber = Utils.formatWhatsAppNumber(phoneNumber);
                if (!formattedNumber) return null;
                
                const encodedMessage = encodeURIComponent(message);
                const baseUrl = useWeb ? 'https://web.whatsapp.com/send' : 'https://wa.me';
                
                if (useWeb) {
                    return `${baseUrl}?phone=${formattedNumber}${message ? `&text=${encodedMessage}` : ''}`;
                } else {
                    return `${baseUrl}/${formattedNumber}${message ? `?text=${encodedMessage}` : ''}`;
                }
            },

            openWhatsAppChat: (phoneNumber, message = '', useWeb = true) => {
                const url = Utils.getWhatsAppChatUrl(phoneNumber, message, useWeb);
                if (url) {
                    if (useWeb) {
                        window.open(url, '_blank', 'width=1200,height=700,scrollbars=yes,resizable=yes');
                    } else {
                        window.open(url, '_blank', 'noopener,noreferrer');
                    }
                    return true;
                }
                return false;
            }
        };

        let testCounter = 1;

        function testWhatsApp(phoneNumber, userName, useWeb = true) {
            const message = `ูุฑุญุจุงู ${userName}ุ ุฃุชูุงุตู ูุนู ูู ุฅุฏุงุฑุฉ ุตูุฏูู ุฏุฑุน ุงูุนุงุฆูุฉ. ููู ูููููู ูุณุงุนุฏุชูุ`;
            
            // Test the formatting
            const formattedNumber = Utils.formatWhatsAppNumber(phoneNumber);
            const fullUrl = Utils.getWhatsAppChatUrl(phoneNumber, message, useWeb);
            
            const resultElement = document.getElementById(`result${testCounter}`);
            const platform = useWeb ? 'ูุงุชุณุงุจ ููุจ' : 'ูุงุชุณุงุจ ููุจุงูู';
            const platformIcon = useWeb ? '๐' : '๐ฑ';
            
            if (formattedNumber && fullUrl) {
                resultElement.innerHTML = `
                    <strong>โ ูุฌุญ ุงูุงุฎุชุจุงุฑ (${platform}):</strong><br>
                    ุงูุฑูู ุงูููุณู: ${formattedNumber}<br>
                    ุงูููุตุฉ: ${platformIcon} ${platform}<br>
                    <br>
                    <strong>ุงูุฑุงุจุท ุงููููุฏ:</strong><br>
                    <a href="${fullUrl}" target="_blank" style="color: #25d366; word-break: break-all;">${fullUrl}</a>
                    <br><br>
                    <button onclick="window.open('${fullUrl}', '_blank', '${useWeb ? 'width=1200,height=700,scrollbars=yes,resizable=yes' : 'noopener,noreferrer'}')" style="background: #25d366;">
                        ${platformIcon} ูุชุญ ูู ${platform}
                    </button>
                `;
                resultElement.style.background = '#e8f5e8';
            } else {
                resultElement.innerHTML = `
                    <strong>โ ูุดู ุงูุงุฎุชุจุงุฑ (${platform}):</strong><br>
                    ุงูุฑูู ุบูุฑ ุตุงูุญ ุฃู ูุงุฑุบ<br>
                    ุงูุฑูู ุงูุฃุตูู: "${phoneNumber}"<br>
                    ุงูุฑูู ุงูููุณู: ${formattedNumber || 'null'}
                `;
                resultElement.style.background = '#fde8e8';
            }
            
            testCounter++;
            if (testCounter > 6) testCounter = 1;
        }

        // Test notification messages
        function testNotification(templateType, userName, ...args) {
            const phoneNumber = '96512345678'; // Test number
            
            // Copy notification templates for testing
            const templates = {
                joiningFeeApproved: (userName) => `๐ก๏ธ ุฏุฑุน ุงูุนุงุฆูุฉ - ุงุนุชูุงุฏ ุงูุนุถููุฉ

ูุจุฑูู ${userName}! ๐

ุชู ุงุนุชูุงุฏ ุฑุณูู ุงูุงูุถูุงู ูุฃุตุจุญุช ุนุถูุงู ูุนุงูุงู ูู ุตูุฏูู ุฏุฑุน ุงูุนุงุฆูุฉ.

โ ุงูุฎุทูุงุช ุงูุชุงููุฉ:
โข ุงุจุฏุฃ ุจุฏูุน ุงูุงุดุชุฑุงูุงุช ุงูุดูุฑูุฉ
โข ุงููุฏู: 240 ุฏ.ู ุฎูุงู 24 ุดูุฑ ููุชุฃูู ูููุฑูุถ
โข ุจุนุฏ ุณูุฉ ูุงููุฉ ุณุชุตุจุญ ูุคููุงู ูุทูุจ ุงููุฑูุถ
โข ุงุญุชูุธ ุจุฑุตูุฏ 500 ุฏ.ู ุนูู ุงูุฃูู

ุฃููุงู ูุณููุงู ุจู ูู ุนุงุฆูุฉ ุฏุฑุน ุงูุนุงุฆูุฉ
ุฅุฏุงุฑุฉ ุงูุตูุฏูู`,

                loanApproved: (userName, loanAmount, installmentAmount, numberOfInstallments) => `๐ก๏ธ ุฏุฑุน ุงูุนุงุฆูุฉ - ุงุนุชูุงุฏ ุงููุฑุถ

ูุจุฑูู ${userName}! ๐ฐ

ุชู ุงุนุชูุงุฏ ุทูุจ ุงููุฑุถ ุจุงูุชูุงุตูู ุงูุชุงููุฉ:

๐ฐ ูุจูุบ ุงููุฑุถ: ${loanAmount} ุฏ.ู
๐ ุงููุณุท ุงูุดูุฑู: ${installmentAmount} ุฏ.ู
๐ข ุนุฏุฏ ุงูุฃูุณุงุท: ${numberOfInstallments} ูุณุท

โ ููููู ุงูุขู:
โข ุงูุจุฏุก ุจุฏูุน ุงูุฃูุณุงุท ูู ุฎูุงู ุงููุธุงู
โข ูุชุงุจุนุฉ ุญุงูุฉ ุงููุฑุถ ูู ุญุณุงุจู
โข ุงูุชูุงุตู ูุนูุง ุนูุฏ ุงูุญุงุฌุฉ

ุชูุงูููุง ูุจุงูุชูููู!
ุฅุฏุงุฑุฉ ุฏุฑุน ุงูุนุงุฆูุฉ`,

                transactionApproved: (userName, amount, transactionType, totalSubscriptions = null) => {
                    const typeText = {
                        'deposit': 'ุงูุฅูุฏุงุน',
                        'withdrawal': 'ุงูุณุญุจ', 
                        'subscription': 'ุงูุงุดุชุฑุงู',
                        'joining_fee': 'ุฑุณูู ุงูุงูุถูุงู'
                    }[transactionType] || 'ุงููุนุงููุฉ';

                    let message = `๐ก๏ธ ุฏุฑุน ุงูุนุงุฆูุฉ - ูุจูู ${typeText}

ูุฑุญุจุงู ${userName} โ

ุชู ูุจูู ${typeText} ุจูุจูุบ ${amount} ุฏ.ู ุจูุฌุงุญ.`;

                    if (transactionType === 'subscription' && totalSubscriptions) {
                        message += `\n\n๐ ุฅุฌูุงูู ุงุดุชุฑุงูุงุชู: ${totalSubscriptions} ุฏ.ู`;
                        
                        const remaining = Math.max(0, 240 - parseFloat(totalSubscriptions));
                        if (remaining > 0) {
                            message += `\n๐ก ุงููุชุจูู ูููุตูู ูู240 ุฏ.ู: ${remaining.toFixed(3)} ุฏ.ู`;
                        } else {
                            message += `\n๐ ูุจุฑูู! ูุตูุช ููุญุฏ ุงููุทููุจ ููุชุฃูู ูููุฑูุถ`;
                        }
                    }

                    message += `\n\nุดูุฑุงู ูู
ุฅุฏุงุฑุฉ ุฏุฑุน ุงูุนุงุฆูุฉ`;
                    return message;
                }
            };

            let message = '';
            try {
                switch (templateType) {
                    case 'joiningFeeApproved':
                        message = templates.joiningFeeApproved(userName);
                        break;
                    case 'loanApproved':
                        message = templates.loanApproved(userName, ...args);
                        break;
                    case 'transactionApproved':
                        message = templates.transactionApproved(userName, ...args);
                        break;
                    default:
                        message = `ุงุฎุชุจุงุฑ ${templateType} ูููุณุชุฎุฏู ${userName}`;
                }

                const url = Utils.getWhatsAppChatUrl(phoneNumber, message, true);
                const resultElement = document.getElementById('result6');
                
                resultElement.innerHTML = `
                    <strong>โ ุชู ุฅูุดุงุก ุงูุฅุดุนุงุฑ:</strong><br>
                    <strong>ุงูููุน:</strong> ${templateType}<br>
                    <strong>ุงููุณุชุฎุฏู:</strong> ${userName}<br>
                    <br>
                    <strong>ูุต ุงูุฑุณุงูุฉ:</strong><br>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; white-space: pre-line; font-family: 'Courier New', monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                        ${message}
                    </div>
                    <br>
                    <button onclick="window.open('${url}', '_blank', 'width=1200,height=700,scrollbars=yes,resizable=yes')" style="background: #25d366;">
                        ๐ ูุชุญ ูู ูุงุชุณุงุจ ููุจ
                    </button>
                `;
                resultElement.style.background = '#e8f5e8';
            } catch (error) {
                document.getElementById('result6').innerHTML = `
                    <strong>โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฅุดุนุงุฑ:</strong><br>
                    ${error.message}
                `;
                document.getElementById('result6').style.background = '#fde8e8';
            }
        }
    </script>
</body>
</html>