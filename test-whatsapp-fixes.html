<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #25d366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #128c7e;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 3px;
        }
        .info {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</h1>
        
        <div class="test-section">
            <h3>1. Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨</h3>
            <p>Ø§Ø®ØªØ¨Ø± ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„ØªØ¨ÙˆÙŠØ¨:</p>
            <button class="test-button" onclick="testTabReuse('96512345678', 'Ù…Ø±Ø­Ø¨Ø§ Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± 1')">
                Ø§Ø®ØªØ¨Ø§Ø± 1: ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨
            </button>
            <button class="test-button" onclick="testTabReuse('96587654321', 'Ù…Ø±Ø­Ø¨Ø§ Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± 2')">
                Ø§Ø®ØªØ¨Ø§Ø± 2: Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨
            </button>
            <div id="result1" class="result" style="display: none;"></div>
            <div class="info">ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙØªØ­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ ÙÙŠ Ù†ÙØ³ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</div>
        </div>

        <div class="test-section">
            <h3>2. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„</h3>
            <p>Ø§Ø®ØªØ¨Ø± Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</p>
            <button class="test-button" onclick="testMobileDetection()">
                Ø§ÙƒØªØ´Ø§Ù Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
            </button>
            <button class="test-button" onclick="testMobileWhatsApp('96512345678', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬ÙˆØ§Ù„')">
                Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬ÙˆØ§Ù„
            </button>
            <button class="test-button" onclick="testWebWhatsApp('96512345678', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆÙŠØ¨')">
                Ø§Ø®ØªØ¨Ø§Ø± Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨
            </button>
            <div id="result2" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h3>
            <p>Ø§Ø®ØªØ¨Ø§Ø± ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:</p>
            <button class="test-button" onclick="testErrorHandling('invalid-number', 'Ø§Ø®ØªØ¨Ø§Ø± Ø±Ù‚Ù… Ø®Ø§Ø·Ø¦')">
                Ø§Ø®ØªØ¨Ø§Ø± Ø±Ù‚Ù… Ø®Ø§Ø·Ø¦
            </button>
            <button class="test-button" onclick="testFallback('96512345678', 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù„Ø¬ÙˆØ§Ù„')">
                Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            </button>
            <div id="result3" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>4. Ø§Ø®ØªØ¨Ø§Ø± Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h3>
            <p>Ø§Ø®ØªØ¨Ø± Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©:</p>
            <button class="test-button" onclick="testTemplate('transactionApproved')">
                Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
            </button>
            <button class="test-button" onclick="testTemplate('loanPaymentApproved')">
                Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø·
            </button>
            <div id="result4" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- Include the utils.js file -->
    <script src="frontend/js/utils.js"></script>
    
    <script>
        // Test functions
        function testTabReuse(phone, message) {
            const result = Utils.openWhatsAppChat(phone, message);
            showResult('result1', `ØªÙ… ÙØªØ­ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨: ${result ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'}`);
        }

        function testMobileDetection() {
            const isMobile = Utils.isMobileDevice();
            const userAgent = navigator.userAgent;
            showResult('result2', `
                Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²: ${isMobile ? 'Ø¬ÙˆØ§Ù„' : 'Ø³Ø·Ø­ Ù…ÙƒØªØ¨'}<br>
                User Agent: ${userAgent.substring(0, 100)}...
            `);
        }

        function testMobileWhatsApp(phone, message) {
            const result = Utils.openWhatsAppChat(phone, message, false);
            showResult('result2', `ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¬ÙˆØ§Ù„: ${result ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'}`);
        }

        function testWebWhatsApp(phone, message) {
            const result = Utils.openWhatsAppChat(phone, message, true);
            showResult('result2', `ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙŠØ¨: ${result ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'}`);
        }

        function testErrorHandling(phone, message) {
            try {
                const result = Utils.openWhatsAppChat(phone, message);
                showResult('result3', `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'}`);
            } catch (error) {
                showResult('result3', `Ø®Ø·Ø£: ${error.message}`);
            }
        }

        function testFallback(phone, message) {
            // Force an error in web version to test fallback
            const originalOpen = window.open;
            let callCount = 0;
            window.open = function(...args) {
                callCount++;
                if (callCount === 1) {
                    throw new Error('Simulated error');
                }
                return originalOpen.apply(this, args);
            };
            
            try {
                const result = Utils.openWhatsAppChat(phone, message, true);
                showResult('result3', `Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ: ${result ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„'} (ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ window.open ${callCount} Ù…Ø±Ø©)`);
            } finally {
                window.open = originalOpen;
            }
        }

        function testTemplate(templateType) {
            // Test with default brand (Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©)
            const templatesDefault = Utils.getWhatsAppTemplates();
            
            // Test with site B brand (ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¬Ø§Ø¯ÙŠ)
            const templatesSiteB = Utils.getWhatsAppTemplates('ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¬Ø§Ø¯ÙŠ');
            
            let messageDefault = '';
            let messageSiteB = '';
            
            switch (templateType) {
                case 'transactionApproved':
                    const userFinancials = {
                        currentBalance: 1250.500,
                        transactionAmount: 10.000,
                        totalSubscriptions: '245.000'
                    };
                    messageDefault = templatesDefault.transactionApproved('Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', '10.000 Ø¯.Ùƒ', 'subscription', userFinancials);
                    messageSiteB = templatesSiteB.transactionApproved('Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', '10.000 Ø¯.Ùƒ', 'subscription', userFinancials);
                    break;
                case 'loanPaymentApproved':
                    messageDefault = templatesDefault.loanPaymentApproved('ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯', '100.000 Ø¯.Ùƒ', '500.000 Ø¯.Ùƒ', '2000.000 Ø¯.Ùƒ', '1500.000 Ø¯.Ùƒ');
                    messageSiteB = templatesSiteB.loanPaymentApproved('ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯', '100.000 Ø¯.Ùƒ', '500.000 Ø¯.Ùƒ', '2000.000 Ø¯.Ùƒ', '1500.000 Ø¯.Ùƒ');
                    break;
            }
            
            showResult('result4', `
                <h4>ğŸ“± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¯Ø±Ø¹ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©):</h4>
                <pre style="white-space: pre-wrap; font-size: 12px; background: #e8f5e8; padding: 10px; border-radius: 5px;">${messageDefault}</pre>
                
                <h4>ğŸ“± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨ (ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¬Ø§Ø¯ÙŠ):</h4>
                <pre style="white-space: pre-wrap; font-size: 12px; background: #e8f0ff; padding: 10px; border-radius: 5px;">${messageSiteB}</pre>
            `);
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.style.display = 'block';
        }
    </script>
</body>
</html>